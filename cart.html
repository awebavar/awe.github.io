<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- ← اضافه شد -->
  <title>سبد خرید | AWE خانه باور</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ==== Header (مثل shop.html) ==== -->
  <header> … </header>

  <!-- ==== Main: نمایش سبد خرید ==== -->
  <main class="cart-page">
    <div class="container">
      <h2>سبد خرید شما</h2>
      <div id="cart-items">
        <!-- آیتم‌ها توسط JS اینجا رندر می‌شوند -->
      </div>
      <div id="cart-total">
        <!-- مجموع قیمت اینجا نشان داده می‌شود -->
      </div>
    </div>
  </main>

  <!-- ==== Footer (مثل shop.html) ==== -->
  <footer> … </footer>

  <!-- ==== اسکریپت‌های لازم ==== -->
  <script src="main.js"></script>
<script>
  // تابع render و دکمه‌ها
  function renderCart() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const container = document.getElementById('cart-items');
    const totalDiv = document.getElementById('cart-total');
    container.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
      container.innerHTML = '<p>سبد خرید شما خالی است.</p>';
      totalDiv.innerHTML = '';
      updateCartCount();
      return;
    }

    cart.forEach(item => {
      const subtotal = item.price * item.qty;
      total += subtotal;

      // markup با دکمه‌های qty و حذف
      const itemHTML = `
        <div class="cart-item">
          <img src="${item.image}" alt="${item.title}">
          <div class="cart-item-title">${item.title}</div>
          <div class="cart-item-price">${item.price.toLocaleString()} تومان</div>
          <div class="qty-controls">
            <button class="decrease" data-id="${item.id}">−</button>
            <span>${item.qty}</span>
            <button class="increase" data-id="${item.id}">+</button>
          </div>
          <div class="cart-item-subtotal">${subtotal.toLocaleString()} تومان</div>
          <button class="remove-btn" data-id="${item.id}">&times;</button>
        </div>`;
      container.insertAdjacentHTML('beforeend', itemHTML);
    });

    totalDiv.innerHTML = `<h3 id="cart-summary">مبلغ کل: ${total.toLocaleString()} تومان</h3>`;

    // اضافه کردن event listener برای دکمه‌ها
    document.querySelectorAll('.increase').forEach(btn =>
      btn.addEventListener('click', () => changeQty(btn.dataset.id, +1))
    );
    document.querySelectorAll('.decrease').forEach(btn =>
      btn.addEventListener('click', () => changeQty(btn.dataset.id, -1))
    );
    document.querySelectorAll('.remove-btn').forEach(btn =>
      btn.addEventListener('click', () => changeQty(btn.dataset.id, 'remove'))
    );

    updateCartCount();
  }

  // تغییر تعداد یا حذف آیتم
  function changeQty(id, delta) {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart = cart.map(item => {
      if (item.id == id) {
        if (delta === 'remove') return null;
        item.qty += delta;
        if (item.qty < 1) return null;
      }
      return item;
    }).filter(Boolean);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
  }

  document.addEventListener('DOMContentLoaded', renderCart);
</script>

</body>
</html>
